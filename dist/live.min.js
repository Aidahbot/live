!function(e){var t={};function n(s){if(t[s])return t[s].exports;var i=t[s]={exports:{},id:s,loaded:!1};return e[s].call(i.exports,i,i.exports,n),i.loaded=!0,i.exports}n.m=e,n.c=t,n.p="",n(0)}([function(e,t,n){(function(e){const t=n(1).EventEmitter,s=n(2),i=new t,r=new s(i);class o{constructor({app_id:e,retries:t}){this.basePrefix="baseStateEvt",this.baseEvtPrefix="baseEvt",this.baseEventName=(e=>`${this.basePrefix}:${e}`),this.eventName=(e=>`${this.baseEvtPrefix}:${e}`),this.channelEventsName=((e,t)=>`${e}:${t}`),this.channelBaseEvent=((e,t)=>`${this.basePrefix}:${e}:${t}`),this.app=e,this.events=[],this.channels={},this.baseEvents=[],this.boundList=[],this.toBeBoundList=[],this.connected=!1,this.retries=t<=10?t:10,this.retriesCount=0,this.baseUrl="wss://live.aidahbot.com/ws",this.state="connecting",this.liveUrl=this.baseUrl+"?app="+this.app,this.logging=!1,this.triggerBase("state_change",this.state),this.socket={},this.connect()}connect(){this.socket=new WebSocket(this.liveUrl),this.socket.onopen=(()=>{this.state="connected",this.connected=!0,this.continueBindingEvents(),this.triggerBase("state_change",this.state)}),this.socket.onclose=(()=>{this.state="closed",this.triggerBase("state_change",this.state)}),this.socket.onerror=(e=>{this.state="connection_error",this.triggerBase("state_change","connection_error"),this.connectionRetries(),this.logError("error in connection",e)}),this.socket.onmessage=(e=>{this.messageEngine(e.data)})}messageEngine(e){try{const t=o.afterRecieve(e);switch(!!t.type){case!0:t.channel?this.triggerChannelBase(t.channel,t.type,t):t.event&&this.triggerBase(t.type,t);break;case!1:t.channel?this.triggerChannelEvent(t.channel,t.event,t.data):t.event&&this.triggerEvent(t.event,t.data)}}catch(e){this.logError(e.message)}}triggerBase(e,t){try{i.emit(this.baseEventName(e),t),this.log("ws event : ",t)}catch(e){console.error(e)}}triggerChannelBase(e,t,n){try{i.emit(this.channelBaseEvent(e,t),n),this.log("ws channel event : ",n)}catch(e){console.error(e)}}triggerEvent(e,t){i.emit(this.eventName(e),t)}triggerChannelEvent(e,t,n){i.emit(this.channelEventsName(e,t),n)}bindBase(e,t){try{o.validateStrings(e),o.validateFunctions(t),r.on(this.baseEventName(e),t),this.log("binding to ws event: ",e)}catch(e){this.logError(e.message)}}continueBindingEvents(){this.log("continue binding...");for(let e=0;e<this.toBeBoundList.length;e++)this.socket.send(this.toBeBoundList[e])}bindEvent(e,t){try{o.validateStrings(e),o.validateFunctions(t);const n={type:"bind",event:e};if(this.events.includes(e)||this.events.push(e),this.log("binding to event: ",e),r.on(this.eventName(e),t),!this.connected)return this.log("waiting for connected event before binding: ",e),this.toBeBoundList.push(o.beforeSend(n));this.socket.send(o.beforeSend(n))}catch(e){this.logError(e.message)}}bindChannelBase(e,t,n){try{o.validateStrings(t),o.validateStrings(e),o.validateFunctions(n),r.on(this.channelBaseEvent(e,t),n),this.log(`binding to base event for channel ${e}: `,t)}catch(e){this.logError(e.message)}}bindChannelEvent(e,t,n){try{o.validateStrings(t),o.validateStrings(e),o.validateFunctions(n);const s={type:"bind",event:t,channel:e};if(!this.channels[e])throw new Error("not not subscribed to channel yet");if(this.channels[e].includes(t)||this.channels[e].push(t),this.log("binding to channel event: ",e,t),r.on(this.channelEventsName(e,t),n),!this.connected)return this.log("waiting for connected event before binding: ",e,t),this.toBeBoundList.push(o.beforeSend(s));this.socket.send(o.beforeSend(s))}catch(e){this.logError(e.message)}}subscribeChannel(e){try{o.validateStrings(e);const t={type:"subscribe",channel:e};return this.channels[e]||(this.channels[e]=[]),this.log("subscribing to channel: ",e),this.connected?(this.socket.send(o.beforeSend(t)),!0):(this.log("waiting for connected event before subscribing: ",e),this.toBeBoundList.push(o.beforeSend(t)))}catch(e){return this.logError(e.message),null}}unBindChannelEvent(e,t){try{if(!this.channels[e])return;if(-1!==this.channels[e].findIndex(e=>e===t)){const n={type:"unbind",event:t,channel:e};return this.log("Unbind  from  event:  ",e,t),r.remove(this.channelEventsName(e,t)),this.connected?(this.socket.send(o.beforeSend(n)),!0):(this.log("waiting for connected event before unbinding: ",e,t),this.toBeBoundList.push(o.beforeSend(n)))}}catch(e){this.logError(e.message)}}unBindEvent(e){if(-1!==this.events.findIndex(t=>t===e)){const t={type:"unbind",event:e};return this.log("Unbinding from event: ",e),r.remove(this.eventName(e)),this.connected?(this.socket.send(o.beforeSend(t)),!0):(this.log("waiting for connected event before unbinding: ",e),this.toBeBoundList.push(o.beforeSend(t)))}}unSubscribeChannel(e){if(!this.channels[e])return;this.channels[e].forEach((t,n)=>{r.remove(this.channelEventsName(e,t),()=>{this.channels[e].splice(n,1)})});const t={type:"unsubscribe",channel:e};return this.connected?(this.socket.send(o.beforeSend(t)),delete this.channels[e],!0):(this.log("waiting for connected event before unsubscribing: ",e),this.toBeBoundList.push(o.beforeSend(t)))}static beforeSend(e){return JSON.stringify(e)}static afterRecieve(e){return JSON.parse(e)}static validateStrings(e){if("string"!=typeof e)throw new TypeError("event name should be a string")}static validateFunctions(e){if("function"!=typeof e)throw new TypeError("callback should be a function")}logError(){this.logging&&console.error(...arguments)}logWarn(){this.logging&&console.warn(...arguments)}log(){this.logging&&console.log(...arguments)}connectionRetries(){const e=Math.floor(10*Math.random());this.logWarn("Critical error, reconnecting in",e,"seconds"),this.retriesCount<this.retries?setTimeout(()=>{this.retriesCount++,this.connect()},parseInt(e+"000")):this.logError("Client was unable to connect after ",this.retriesCount," attempts exiting...")}}e.AidahLive=class extends o{constructor(e,{retries:t}){super({app_id:e,retries:t||10})}get connection(){return{bind:(e,t)=>{super.bindBase(e,t)},state:super.state}}bind(e,t){super.bindEvent(e,t)}unbind(e){return!!super.unBindEvent(e)}subscribe(e){return super.subscribeChannel(e)?{bind:(t,n)=>{super.bindChannelEvent(e,t,n)},unbind:t=>{super.unBindChannelEvent(e,t)},connection:{bind:(t,n)=>{super.bindChannelBase(e,t,n)}}}:null}unsubscribe(e){return!!super.unSubscribeChannel(e)}}}).call(t,function(){return this}())},function(e,t){function n(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function s(e){return"function"==typeof e}function i(e){return"object"==typeof e&&null!==e}function r(e){return void 0===e}e.exports=n,n.EventEmitter=n,n.prototype._events=void 0,n.prototype._maxListeners=void 0,n.defaultMaxListeners=10,n.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},n.prototype.emit=function(e){var t,n,o,h,a,c;if(this._events||(this._events={}),"error"===e&&(!this._events.error||i(this._events.error)&&!this._events.error.length)){if((t=arguments[1])instanceof Error)throw t;var l=new Error('Uncaught, unspecified "error" event. ('+t+")");throw l.context=t,l}if(r(n=this._events[e]))return!1;if(s(n))switch(arguments.length){case 1:n.call(this);break;case 2:n.call(this,arguments[1]);break;case 3:n.call(this,arguments[1],arguments[2]);break;default:h=Array.prototype.slice.call(arguments,1),n.apply(this,h)}else if(i(n))for(h=Array.prototype.slice.call(arguments,1),o=(c=n.slice()).length,a=0;a<o;a++)c[a].apply(this,h);return!0},n.prototype.addListener=function(e,t){var o;if(!s(t))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,s(t.listener)?t.listener:t),this._events[e]?i(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,i(this._events[e])&&!this._events[e].warned&&(o=r(this._maxListeners)?n.defaultMaxListeners:this._maxListeners)&&o>0&&this._events[e].length>o&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace()),this},n.prototype.on=n.prototype.addListener,n.prototype.once=function(e,t){if(!s(t))throw TypeError("listener must be a function");var n=!1;function i(){this.removeListener(e,i),n||(n=!0,t.apply(this,arguments))}return i.listener=t,this.on(e,i),this},n.prototype.removeListener=function(e,t){var n,r,o,h;if(!s(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(o=(n=this._events[e]).length,r=-1,n===t||s(n.listener)&&n.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(i(n)){for(h=o;h-- >0;)if(n[h]===t||n[h].listener&&n[h].listener===t){r=h;break}if(r<0)return this;1===n.length?(n.length=0,delete this._events[e]):n.splice(r,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},n.prototype.removeAllListeners=function(e){var t,n;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(s(n=this._events[e]))this.removeListener(e,n);else if(n)for(;n.length;)this.removeListener(e,n[n.length-1]);return delete this._events[e],this},n.prototype.listeners=function(e){return this._events&&this._events[e]?s(this._events[e])?[this._events[e]]:this._events[e].slice():[]},n.prototype.listenerCount=function(e){if(this._events){var t=this._events[e];if(s(t))return 1;if(t)return t.length}return 0},n.listenerCount=function(e,t){return e.listenerCount(t)}},function(e,t){"use strict";var n=Object.prototype.hasOwnProperty,s=0;function i(e){if(!(this instanceof i))return new i(e);this.id=s++,this.ee=e}i.prototype.on=function(e,t,n){return t.__ultron=this.id,this.ee.on(e,t,n),this},i.prototype.once=function(e,t,n){return t.__ultron=this.id,this.ee.once(e,t,n),this},i.prototype.remove=function(){var e,t=arguments,s=this.ee;if(1===t.length&&"string"==typeof t[0])t=t[0].split(/[, ]+/);else if(!t.length)if(s.eventNames)t=s.eventNames();else if(s._events){for(e in t=[],s._events)n.call(s._events,e)&&t.push(e);Object.getOwnPropertySymbols&&(t=t.concat(Object.getOwnPropertySymbols(s._events)))}for(var i=0;i<t.length;i++)for(var r=s.listeners(t[i]),o=0;o<r.length;o++){if((e=r[o]).listener){if(e.listener.__ultron!==this.id)continue}else if(e.__ultron!==this.id)continue;s.removeListener(t[i],e)}return this},i.prototype.destroy=function(){return!!this.ee&&(this.remove(),this.ee=null,!0)},e.exports=i}]);